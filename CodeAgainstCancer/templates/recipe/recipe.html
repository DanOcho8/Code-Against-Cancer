{% extends "base.html" %}
{% load static %}

{% block title %} Recipe {% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center pt-4">Recipes</h1>
    <p class="text-center">
        Food recipes that are tailored to you!
    </p>

    {% if messages %}
        <div class="mt-3">
            {% for message in messages %}
                {% if message.tags == "error" %}  <!-- Only display error messages -->
                    <div class="alert alert-danger text-center">{{ message }}</div>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}

    <div class="d-flex justify-content-center align-items-center mb-0">
        <button class="btn btn-primary me-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWidthExample1" aria-expanded="false" aria-controls="collapseWidthExample1">
            Dietary Restrictions
        </button>
        
        <button class="btn btn-primary me-2" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWidthExample2" aria-expanded="false" aria-controls="collapseWidthExample2">
            Recommended Foods
        </button>
        <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseWidthExample3" aria-expanded="false" aria-controls="collapseWidthExample3">
            Special Instructions
        </button>
    </div>

        <div class="d-flex" style="min-height: 100px;">
            <div class="collapse collapse-horizontal mb-2 mt-2" id="collapseWidthExample1">
                <div class="card card-body" style="width: 500px; height: 180px;">
                    Dietary Restrictions: {{ dietary_restrictions }}
                </div>
            </div>
            <div class="collapse collapse-horizontal mb-2 mt-2" id="collapseWidthExample2">
                <div class="card card-body" style="width: 500px; height: 180px;">
                    Recommended Foods: {{ recommended_foods }}
                </div>
            </div>
            <div class="collapse collapse-horizontal mb-2 mt-2" id="collapseWidthExample3">
                <div class="card card-body" style="width: 500px; height: 180px;">
                    Special Instructions: {{ special_instructions }}
                </div>
            </div>
        </div>
    
 <!--this is the search bar/ passes the users search result as a query in the url to the url.py then to the search recipes in views.py-->
 <!--uses GET as a HTTP method when sending form data as a query paramter to the url/ action tell where to send it too-->
    <form class="d-flex" method="GET" action="{% url 'searchRecipes' %}">
        <input class="form-control me-2" type="search" name="query" value="{{ query }}" placeholder="Search for Recipes..." aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
    </form>

    <!-- Recipes Section -->
    <div class="container mt-4 pb-5">
        {% if recipes %}
            <div class="row">
                {% for item in recipes %}
                    <div class="col-md-4">
                        <div class="card mb-4 shadow-sm">
                            <img src="{{ item.recipe.image }}" class="card-img-top" alt="Recipe Image">
                            <div class="card-body">
                                <h5 class="card-title">{{ item.recipe.label }}</h5>
                                <p class="card-text">Calories: {{ item.recipe.calories|floatformat:0 }}</p>
                                <a href="{{ item.recipe.url }}" class="btn btn-primary" target="_blank">View Recipe</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-center">No recipes found</p>
        {% endif %}


    <div class="d-flex justify-content-between mt-4">
        {% if hasPrevPage %}
            <a class="btn btn-secondary" href="?query={{ query }}&page={{ page|add:-1 }}">Previous</a>
        {% else %}
            <button class="btn btn-secondary" disabled>Previous</button>
        {% endif %}

        {% if hasNextPage %}
            <a class="btn btn-secondary" href="?query={{ query }}&page={{ page|add:1 }}">Next</a>
        {% else %}
            <button class="btn btn-secondary" disabled>Next</button>
        {% endif %}
    </div>

    </div>


    
</div>
{% endblock %}
{% extends "base.html" %}
{% load static %}

{% block title %} Calorie Tracker | CaC{% endblock %}

{% block content %}
<div class="container text-center mt-4">
    <h2 class="text-center gradient-text fw-bold">
        Your Calorie Intake for
        {% if selected_date == today %}
            Today
        {% elif selected_date == yesterday %}
            Yesterday
        {% elif selected_date == tomorrow %}
            Tomorrow
        {% else %}
            {{ selected_date|date:"m-d-Y" }}
        {% endif %}
    </h2>

    <form method="GET" action="{% url 'calorieTracker:calorie_tracker' %}" class="d-flex justify-content-center mt-3">
        <input type="date" name="date" value="{{ selected_date|date:'Y-m-d' }}" class="form-control w-25">
        <button type="submit" class="btn btn-primary ms-2">View</button>
    </form>

    <!-- Totals Section -->
    <div class="row justify-content-center mt-5 mb-4">
        <div class="col-auto">
            <p class="fw-bold fs-4">Total Calories: <span class="text-success">{{ total_calories }}</span></p>
        </div>
        <div class="col-auto">
            <p class="fw-bold fs-4">Total Protein: <span class="text-success">{{ total_protein }}g</span></p>
        </div>
    </div>

    <!-- Food Entries -->
    <div class="list-group w-50 mx-auto mb-4">
        <h4 class="text-primary">Food Entries</h4>
        {% if calorie_entries or searched_food_items %}
            {% for entry in calorie_entries %}
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        {{ entry.food_item.name }} - {{ entry.amount_in_grams|floatformat:2 }}g - {{ entry.calculated_calories|floatformat:2 }} calories - {{ entry.calculated_protein|floatformat:2 }}g protein
                    </span>
                    <!-- Delete Form -->
                    <form method="POST" action="{% url 'calorieTracker:delete_calorie_entry' entry.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="date" value="{{ selected_date|date:'Y-m-d' }}">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this entry?');">
                            <img src="{% static 'images/trash.png' %}" alt="Delete" style="width: 16px; height: 16px;">
                        </button>
                    </form>
                </div>
            {% endfor %}
            {% for item in searched_food_items %}
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <span>
                        {{ item.description }} - {{ item.total_calories|floatformat:2 }} calories - {{ item.total_protein|floatformat:2 }}g protein
                    </span>
                    <!-- Delete Form -->
                    <form method="POST" action="{% url 'calorieTracker:delete_calorie_entry' item.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="date" value="{{ selected_date|date:'Y-m-d' }}">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this entry?');">
                            <img src="{% static 'images/trash.png' %}" alt="Delete" style="width: 16px; height: 16px;">
                        </button>
                    </form>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-muted">No food entries yet.</p>
        {% endif %}
    </div>
    

    <!-- Add Entry Button -->
    <a href="{% url 'calorieTracker:add_entry' %}?date={{ selected_date|date:'Y-m-d' }}" 
       class="btn btn-primary mt-4">
        Add Entry
    </a>

    {% include 'calorie/widgets/bmi_calculator.html' %}
</div>
{% endblock %}
